<div class="flex flex-col flex-auto min-w-0">
    <!-- Header -->
    <div class="bg-card">
        <div class="flex flex-col w-full max-w-screen-xl mx-auto px-6 sm:px-8">
            <div class="flex flex-col sm:flex-row flex-auto sm:items-center min-w-0 my-8 sm:my-12">
                <!-- Avatar and name -->
                <div class="flex flex-auto items-center min-w-0">
                    <div class="flex-0 w-16 h-16 rounded-full overflow-hidden">
                        <img *ngIf="user.avatar" class="w-full h-full object-cover" [src]="user.avatar">
                        <mat-icon
                            class="w-full h-full object-cover"
                            *ngIf="!user.avatar"
                            [svgIcon]="'heroicons_solid:user-circle'">
                        </mat-icon>
                    </div>
                    <div class="flex flex-col min-w-0 ml-4">
                        <ng-container *transloco="let t">
                            <div class="text-2xl md:text-5xl font-semibold tracking-tight leading-7 md:leading-snug truncate">Bienvenu, {{user.firstName}}!</div>
                        </ng-container>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main -->
    <div class="flex-auto border-t -mt-px pt-4 sm:pt-6">
        <div class="w-full max-w-screen-xl mx-auto">
            <!-- Tabs -->
            <mat-tab-group
                class="sm:px-2"
                [animationDuration]="'0'">

                <!-- Home -->
                <mat-tab label="Statistiques des 30 derniers jours">
                    <ng-template matTabContent>
                        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6 w-full min-w-0" *ngIf="stats">
                            <!-- Summary -->
                            <div class="flex flex-col flex-auto p-6 bg-card shadow rounded-2xl overflow-hidden">
                                <div class="flex items-start justify-between">
                                    <div class="text-lg font-medium tracking-tight leading-6 truncate">Bénéfice en Ariary</div>
                                    <!-- <div class="ml-2 -mt-2 -mr-3">
                                        <button
                                            mat-icon-button
                                            [matMenuTriggerFor]="summaryMenu">
                                            <mat-icon
                                                class="icon-size-5"
                                                [svgIcon]="'heroicons_solid:dots-vertical'"></mat-icon>
                                        </button>
                                        <mat-menu #summaryMenu="matMenu">
                                            <button mat-menu-item>Yesterday</button>
                                            <button mat-menu-item>2 days ago</button>
                                            <button mat-menu-item>3 days ago</button>
                                        </mat-menu>
                                    </div> -->
                                </div>
                                <div class="flex flex-col items-center mt-6">
                                    <div class="text-4xl sm:text-5xl font-bold tracking-tight leading-none text-blue-500">{{formatNumberWithSpaceSeparator(stats?.revenue.profit)}}</div>
                                    <div class="flex items-baseline justify-center w-full mt-5 text-secondary">
                                        <div class="text-md font-medium truncate">Dépense:</div>
                                        <div class="ml-1.5 text-lg font-semibold">{{stats?.revenue.expenses}}</div>
                                    </div>
                                    <div class="flex items-baseline justify-center w-full mt-1 text-secondary">
                                        <div class="text-md font-medium truncate">Revenu:</div>
                                        <div class="ml-1.5 text-lg font-semibold">{{stats?.revenue.income}}</div>
                                    </div>
                                </div>
                            </div>
                            <!-- Overdue -->
                            <div class="flex flex-col flex-auto p-6 bg-card shadow rounded-2xl overflow-hidden">
                                <div class="flex items-start justify-between">
                                    <div class="text-lg font-medium tracking-tight leading-6 truncate">Rendez-vous</div>
                                    <!-- <div class="ml-2 -mt-2 -mr-3">
                                        <button
                                            mat-icon-button
                                            [matMenuTriggerFor]="overdueMenu">
                                            <mat-icon
                                                class="icon-size-5"
                                                [svgIcon]="'heroicons_solid:dots-vertical'"></mat-icon>
                                        </button>
                                        <mat-menu #overdueMenu="matMenu">
                                            <button mat-menu-item>Yesterday</button>
                                            <button mat-menu-item>2 days ago</button>
                                            <button mat-menu-item>3 days ago</button>
                                        </mat-menu>
                                    </div> -->
                                </div>
                                <div class="flex flex-col items-center mt-6">
                                    <div class="text-4xl sm:text-5xl font-bold tracking-tight leading-none text-green-500">{{stats?.appointments.total}}</div>
                                    <div class="flex items-baseline justify-center w-full mt-5 text-secondary">
                                        <div class="text-md font-medium truncate">Placé:</div>
                                        <div class="ml-1.5 text-lg font-semibold">{{stats?.appointments.ready}}</div>
                                    </div>
                                    <div class="flex items-baseline justify-center w-full mt-1 text-secondary">
                                        <div class="text-md font-medium truncate">En cours:</div>
                                        <div class="ml-1.5 text-lg font-semibold">{{stats?.appointments.inProgress}}</div>
                                    </div>
                                    <div class="flex items-baseline justify-center w-full mt-1 text-secondary">
                                        <div class="text-md font-medium truncate">Effectué:</div>
                                        <div class="ml-1.5 text-lg font-semibold">{{stats?.appointments.finished}}</div>
                                    </div>
                                </div>
                            </div>
                            <!-- Issues -->
                            <div class="flex flex-col flex-auto p-6 bg-card shadow rounded-2xl overflow-hidden">
                                <div class="flex items-start justify-between">
                                    <div class="text-lg font-medium tracking-tight leading-6 truncate">Commission en Ariary</div>
                                    <!-- <div class="ml-2 -mt-2 -mr-3">
                                        <button
                                            mat-icon-button
                                            [matMenuTriggerFor]="issuesMenu">
                                            <mat-icon
                                                class="icon-size-5"
                                                [svgIcon]="'heroicons_solid:dots-vertical'"></mat-icon>
                                        </button>
                                        <mat-menu #issuesMenu="matMenu">
                                            <button mat-menu-item>Yesterday</button>
                                            <button mat-menu-item>2 days ago</button>
                                            <button mat-menu-item>3 days ago</button>
                                        </mat-menu>
                                    </div> -->
                                </div>
                                <div class="flex flex-col items-center mt-6">
                                    <div class="text-4xl sm:text-5xl font-bold tracking-tight leading-none text-amber-500">{{formatNumberWithSpaceSeparator(stats?.commission.amount)}}</div>
                                    <div class="flex items-baseline justify-center w-full mt-5 text-secondary">
                                        <div class="text-md font-medium truncate">Nombre:</div>
                                        <div class="ml-1.5 text-lg font-semibold">{{stats?.commission.number}} commission</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </ng-template>
                </mat-tab>

                <!-- Services -->
                <mat-tab label="Services">
                    <ng-template matTabContent>
                        <!-- Title and action buttons -->
                        <div class="flex items-center justify-between w-full">
                            <div>
                                <h2 class="text-3xl font-semibold tracking-tight leading-8">Services</h2>
                                <div class="font-medium tracking-tight text-secondary">Gestion des services</div>
                            </div>
                            <div class="flex items-center ml-6">
                                <button
                                    class="hidden sm:inline-flex ml-3"
                                    mat-flat-button
                                    [color]="'primary'"
                                    *ngIf="showDefault"
                                    (click)="showDefault = false"
                                    >
                                    <mat-icon
                                        class="icon-size-5"
                                        [svgIcon]="'heroicons_solid:plus'">
                                        </mat-icon>
                                    <span class="ml-2">Créer un service</span>
                                </button>

                                <button class="hidden sm:inline-flex ml-3" mat-flat-button (click)="cancel()" *ngIf="!showDefault">
                                    Voir les services
                                </button>

                                <!-- Actions menu (visible on xs) -->
                                <div class="sm:hidden">
                                    <button
                                        [matMenuTriggerFor]="actionsMenu"
                                        mat-icon-button>
                                        <mat-icon [svgIcon]="'heroicons_outline:dots-vertical'"></mat-icon>
                                    </button>
                                    <mat-menu #actionsMenu="matMenu">
                                        <button mat-menu-item *ngIf="showDefault" (click)="showDefault = false">Créer un service</button>
                                        <button mat-menu-item *ngIf="!showDefault" (click)="cancel()">Voir les services</button>
                                    </mat-menu>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 sm:grid-cols-6 gap-6 w-full min-w-0 mt-8" *ngIf="showDefault">
                            <!-- Liste des services -->
                            <div class="sm:col-span-6 flex flex-col flex-auto p-6 bg-card shadow rounded-2xl overflow-hidden">
                                <div class="text-lg font-medium tracking-tight leading-6 truncate">Liste des services</div>
                                <div class="text-secondary font-medium">{{services?.rows?.length}} services</div>
                                <div class="flex flex-col flex-auto mt-2 overflow-x-auto">
                                    <div class="flex flex-col items-center justify-center mb-10" *ngIf="loadingData">
                                        <mat-progress-spinner [diameter]="60" [mode]="'indeterminate'">
                                        </mat-progress-spinner>
                                    </div>
                                    <div class="flex flex-col items-center justify-center mb-10" *ngIf="!loadingData && services?.rows?.length === 0">
                                        <mat-icon [svgIcon]="'heroicons_outline:information-circle'"></mat-icon>
                                        <h2 class="text-secondary text-3xl"><strong>Aucun service trouvé</strong></h2>
                                    </div>
                                    <table
                                        *ngIf="!loadingData && services?.rows?.length !== 0"
                                        class="min-w-240 overflow-y-visible"
                                        mat-table
                                        [dataSource]="services.rows">

                                        <!-- Nom -->
                                        <ng-container matColumnDef="name">
                                            <th
                                                mat-header-cell
                                                *matHeaderCellDef>
                                                Nom du service
                                            </th>
                                            <td
                                                mat-cell
                                                *matCellDef="let s">
                                                <span class="font-medium text-right">
                                                    {{s.name}}
                                                </span>
                                            </td>
                                        </ng-container>

                                        <!-- Prix -->
                                        <ng-container matColumnDef="price">
                                            <th
                                                mat-header-cell
                                                *matHeaderCellDef>
                                                Prix
                                            </th>
                                            <td
                                                mat-cell
                                                *matCellDef="let s">
                                                {{s.price}}
                                            </td>
                                        </ng-container>

                                        <!-- Prix -->
                                        <ng-container matColumnDef="commissionPercentage">
                                            <th
                                                mat-header-cell
                                                *matHeaderCellDef>
                                                Commission
                                            </th>
                                            <td
                                                mat-cell
                                                *matCellDef="let s">
                                                {{s.commissionPercentage}}%
                                            </td>
                                        </ng-container>

                                        <!-- processingTime -->
                                        <ng-container matColumnDef="processingTime">
                                            <th
                                                mat-header-cell
                                                *matHeaderCellDef>
                                                Temps d'exécution
                                            </th>
                                            <td
                                                mat-cell
                                                *matCellDef="let s">
                                                <span class="flex items-center">
                                                    <span>
                                                        <!-- Low -->
                                                        <span
                                                            class="flex items-end w-1 h-4 bg-red-200 rounded overflow-hidden"
                                                            *ngIf="s.processingTime < 3">
                                                            <span class="flex w-full h-1/3 bg-red-600"></span>
                                                        </span>
                                                        <!-- Medium -->
                                                        <span
                                                            class="flex items-end w-1 h-4 bg-orange-200 rounded overflow-hidden"
                                                            *ngIf="s.processingTime >= 3 && s.processingTime < 5">
                                                            <span class="flex w-full h-2/4 bg-orange-400"></span>
                                                        </span>
                                                        <!-- High -->
                                                        <span
                                                            class="flex items-end w-1 h-4 bg-green-100 rounded overflow-hidden"
                                                            *ngIf="s.processingTime >= 5">
                                                            <span class="flex w-full h-full bg-green-400"></span>
                                                        </span>
                                                    </span>
                                                    <span class="ml-3 leading-4">{{s.processingTime}} heures</span>
                                                </span>
                                            </td>
                                        </ng-container>

                                        <!-- Action column -->
                                        <ng-container matColumnDef="actions">
                                            <th mat-header-cell *matHeaderCellDef class="flex flex-row justify-end">
                                                Actions
                                            </th>
                                            <td mat-cell *matCellDef="let s" class="flex flex-row justify-end">
                                                <button mat-icon-button (click)="showDefault = false; isEdit = true; setServiceForm(s)">
                                                    <mat-icon>edit</mat-icon>
                                                </button>
                                                <button mat-icon-button (click)="openConfirmationDialog(s)">
                                                    <mat-icon class="text-red-500">delete</mat-icon>
                                                </button>
                                            </td>
                                        </ng-container>

                                        <tr
                                            mat-header-row
                                            *matHeaderRowDef="services.columns"></tr>
                                        <tr
                                            mat-row
                                            *matRowDef="let row; columns: services.columns;"></tr>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <form class="xl:col-span-4 flex flex-col flex-auto bg-card shadow rounded-2xl mt-8 overflow-hidden"
                            [formGroup]="serviceForm"
                            *ngIf="!showDefault"
                        >
                            <!-- Alert -->
                            <div class="flex flex-col p-8" *ngIf="showAlert">
                                <fuse-alert
                                    class="mb-4"
                                    [appearance]="'outline'"
                                    [showIcon]="false"
                                    [type]="alert.type"
                                    [@shake]="alert.type === 'error'">
                                    {{alert.message}}
                                </fuse-alert>
                            </div>

                            <div class="bg-gray-50 dark:bg-gray-700 p-8 border-b">
                                <p class="text-lg font-medium">Créer un service</p>
                                <p class="text-secondary">Ajouter un nouveau service pour les clients</p>
                            </div>
                            <div class="flex flex-col p-8">
                                <mat-form-field class="fuse-mat-dense flex-auto">
                                    <mat-label>Nom</mat-label>
                                    <input matInput [formControlName]="'name'">
                                    <mat-error *ngIf="serviceForm.get('name').hasError('required')">
                                        Le champ nom est requis
                                    </mat-error>
                                </mat-form-field>
                                <mat-form-field class="fuse-mat-dense flex-auto">
                                    <mat-label>Prix en ariary</mat-label>
                                    <input matInput [formControlName]="'price'">
                                    <mat-error *ngIf="serviceForm.get('price').hasError('required')">
                                        Le champ prix est requis
                                    </mat-error>
                                </mat-form-field>
                                <mat-form-field class="fuse-mat-dense flex-auto">
                                    <mat-label>Temps en heure</mat-label>
                                    <input matInput [formControlName]="'processingTime'">
                                    <mat-error *ngIf="serviceForm.get('processingTime').hasError('required')">
                                        Le champ temps est requis
                                    </mat-error>
                                </mat-form-field>
                                <mat-form-field class="fuse-mat-dense flex-auto">
                                    <mat-label>Pourcentage de commission</mat-label>
                                    <input matInput [formControlName]="'commissionPercentage'">
                                    <mat-error *ngIf="serviceForm.get('commissionPercentage').hasError('required')">
                                        Le champ temps est requis
                                    </mat-error>
                                </mat-form-field>
                            </div>

                            <div class="flex items-center justify-end border-t px-8 py-5 bg-gray-50 dark:bg-gray-700">
                                <button mat-button (click)="cancel()">
                                    Annuler
                                </button>
                                <button
                                    class="px-6 ml-3"
                                    mat-flat-button
                                    [color]="'primary'"
                                    [disabled]="serviceForm.disabled"
                                    (click)="!isEdit ? createService() : updateService()">
                                    <span *ngIf="!serviceForm.disabled">
                                        Sauvegarder
                                    </span>
                                    <mat-progress-spinner
                                        *ngIf="serviceForm.disabled"
                                        [diameter]="24"
                                        [mode]="'indeterminate'">
                                    </mat-progress-spinner>
                                </button>
                            </div>
                        </form>

                    </ng-template>
                </mat-tab>

                <!-- Team -->
                <mat-tab label="Personnels">
                    <ng-template matTabContent>
                        <!-- Main actions -->
                        <div class="flex items-center mt-4 sm:mt-0 md:mt-4">
                            <!-- Search -->
                            <div class="flex-auto">
                                <mat-form-field class="fuse-mat-dense fuse-mat-no-subscript fuse-mat-rounded w-full min-w-50">
                                    <mat-icon
                                        class="icon-size-5"
                                        matPrefix
                                        [svgIcon]="'heroicons_solid:search'"></mat-icon>
                                    <input
                                        matInput
                                        [formControl]="searchInputControl"
                                        [autocomplete]="'off'"
                                        [placeholder]="'Rechercher un employé'">
                                </mat-form-field>
                            </div>
                            <!-- Add contact button -->
                            <button
                                class="ml-4"
                                mat-flat-button
                                [color]="'primary'"
                                (click)="createContact()">
                                <mat-icon [svgIcon]="'heroicons_outline:plus'"></mat-icon>
                                <span class="ml-2 mr-1">Ajouter</span>
                            </button>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 w-full min-w-0 mt-4">
                            <ng-container *ngFor="let emp of filteredEmployes">
                                <div class="flex flex-col flex-auto items-center bg-card shadow rounded-2xl overflow-hidden">
                                    <!-- Avatar & Info -->
                                    <div class="flex flex-col flex-auto w-full p-8 text-center">
                                        <div class="w-32 h-32 mx-auto rounded-full overflow-hidden">
                                            <img *ngIf="emp?.avatar" class="w-full h-full object-cover" [src]="emp.avatar">
                                            <mat-icon class="w-full h-full object-cover" *ngIf="!emp.avatar" [svgIcon]="'heroicons_solid:user-circle'"></mat-icon>
                                        </div>
                                        <div class="mt-6 font-medium">{{emp.lastName}} {{emp.firstName}}</div>
                                        <div class="text-secondary">{{emp.email}}</div>
                                    </div>
                                    <!-- Email & edit -->
                                    <div class="flex items-center w-full border-t divide-x">
                                        <a
                                            class="flex flex-auto items-center justify-center py-4 hover:bg-hover"
                                            [href]="'mailto:' + emp.email">
                                            <mat-icon
                                                class="icon-size-5 text-hint"
                                                [svgIcon]="'heroicons_solid:mail'"></mat-icon>
                                            <span class="ml-2">Email</span>
                                        </a>
                                        <a style="cursor: pointer" (click)="navigateToProfile(emp._id)" class="flex flex-auto items-center justify-center py-4 hover:bg-hover">
                                            <mat-icon
                                                class="icon-size-5 text-hint"
                                                [svgIcon]="'heroicons_solid:pencil'"></mat-icon>
                                            <span class="ml-2">Modifier</span>
                                        </a>
                                    </div>
                                </div>
                            </ng-container>
                        </div>
                    </ng-template>
                </mat-tab>

            </mat-tab-group>
        </div>
    </div>

</div>
